<div class="owner-statistics-wrapper">
  <nav>
    <app-nav-bar activePage="statistics"></app-nav-bar>
  </nav>

  <main class="statistics-container">
    <!-- Loading State -->
    <div *ngIf="loading" class="loading-state">
      <div class="spinner-border" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
      <p>Loading statistics data...</p>
    </div>

    <!-- Error State -->
    <div *ngIf="error && !loading" class="error-state">
      <div class="alert alert-danger">
        <i class="bi bi-exclamation-triangle"></i>
        {{ error }}
        <button class="btn btn-sm btn-outline-danger ms-2" (click)="loadData()">
          Try Again
        </button>
      </div>
    </div>

    <!-- Statistics Content -->
    <div *ngIf="!loading && !error" class="statistics-content">
      <!-- Statistics Overview -->
      <div class="stats-section">
        <!-- Summary Cards - Main Stats -->
        <div class="summary-cards">
          <div class="summary-card">
            <div class="summary-content">
              <h3>{{ getTotalBookings() }}</h3>
              <p>Total Bookings</p>
            </div>
          </div>

          <div class="summary-card">
            <div class="summary-content">
              <h3>{{ getTotalRevenue() }}€</h3>
              <p>Total Revenue</p>
            </div>
          </div>

          <div class="summary-card">
            <div class="summary-content">
              <h3>{{ getAverageBookingValue() | number:'1.0-0' }}€</h3>
              <p>Average Booking Value</p>
            </div>
          </div>

          <div class="summary-card">
            <div class="summary-content">
              <h3>{{ userCottages.length }}</h3>
              <p>Total Cottages</p>
            </div>
          </div>
        </div>

        <!-- Key Insights -->
        <div class="insights-row">
          <div class="insight-item">
            <i class="bi bi-trophy"></i>
            <div class="insight-text">
              <h4>Top Performing Cottage</h4>
              <p>{{ getTopPerformingCottage() }}</p>
            </div>
          </div>

          <div class="insight-item">
            <i class="bi bi-calendar-month"></i>
            <div class="insight-text">
              <h4>Peak Booking Month</h4>
              <p>{{ getPeakBookingMonth() }}</p>
            </div>
          </div>

          <div class="insight-item">
            <i class="bi bi-weekend"></i>
            <div class="insight-text">
              <h4>Weekend Preference</h4>
              <p>{{ getWeekendPreference() }}% of bookings include weekends</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Charts Section -->
      <div class="charts-section">
        <!-- Monthly Reservations Chart -->
        <div class="chart-container">
          <div class="chart-header">
            <h2>Reservations by Month</h2>
            <p>Number of reservations for each month of the year</p>
          </div>
          <div class="chart-wrapper">
            <canvas #monthlyBookingsChart></canvas>
          </div>
        </div>

        <!-- Weekend vs Weekday Chart -->
        <div class="chart-container">
          <div class="chart-header">
            <h2>Weekend vs Weekday Reservations</h2>
            <p>Ratio between reservations on weekdays and weekends</p>
          </div>
          <div class="chart-wrapper">
            <canvas #weekendWeekdayChart></canvas>
          </div>
        </div>
      </div>

    </div>
  </main>
</div>
